# Dev mode: sidecar + telegram-bridge only
# Agent and UI run locally on the host
# Source directories are mounted and services auto-reload on changes

services:
  sidecar:
    build:
      context: .
      dockerfile: codex-sdk-sidecar/Dockerfile
    network_mode: host
    volumes:
      - ./codex-sdk-sidecar/src:/app/src:ro
    command: ["npx", "tsx", "watch", "src/index.ts"]
    environment:
      - SIDECAR_HOST=127.0.0.1
      - SIDECAR_PORT=8788
      - SIDECAR_TOKEN=${SIDECAR_TOKEN:-}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - CODEX_MODEL=${CODEX_MODEL:-}

  telegram-bridge:
    build:
      context: .
      dockerfile: bridges/telegram/Dockerfile
    network_mode: host
    volumes:
      - ./bridges/telegram:/app/bridges/telegram:ro
    command: ["watchmedo", "auto-restart", "--directory=/app/bridges/telegram", "--pattern=*.py", "--recursive", "--", "python", "-m", "bridges.telegram.main"]
    environment:
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - TELEGRAM_CHAT_ID=${TELEGRAM_CHAT_ID}
      - AGENT_URL=http://127.0.0.1:8787
      - AGENT_TOKEN=${AGENT_TOKEN:-}
